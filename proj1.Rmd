---
title: "Statisitcal Programming - 2020 - Project 1"
output: rmarkdown::html_document
author: Add your name here
---

Due on Monday, November 2nd by 5:00 pm (17:00), UK local time.

Before you start be sure to read through *all* of the rules and instructions in the `README.md`.

<br/>

### Data

```{r}
library(tidyverse)
f1 = readRDS(file="data/f1.rds")
```


<br/>

### Task 1 - Tidy the data

#### Write up

In this task we mainly utilize the `hoist()` function to extract the relevant information
from the dataset before finishing with the `mutate()` function to convert the data
into the appropriate types. Note that the positions “R” (retired), “D” (disqualified), 
“E” (excluded),  “W” (withdrawn), “F” (failed to qualify) and “N” (not classified) 
provided in the original data have all been intentionally coerced into `NA` values
since all of these positions correspond to a driver failing to complete a race.

#### Code

```{r task1}
f1_tbl = tibble(f1_data = f1) %>%
  # ------------------ Pulling out relevant information ------------------ #
  unnest_wider(f1_data) %>%
  hoist(
    MRData,
    races = c('RaceTable', 'Races')
  ) %>% select(races) %>%
  unnest_longer(races) %>%
  hoist(
    races,
    race_name = c('raceName'),
    round = c('round'),
    date = (c('date')),
    results = c('Results')
  ) %>% select(-races) %>%
  unnest_longer(results) %>%
  hoist(
    results,
    first_name = c('Driver', 'givenName'),
    last_name = c('Driver', 'familyName'),
    constructor = c('Constructor', 'name'),
    position = c('positionText'),
    points = c('points')
    ) %>%
  # --------------- Mutating data to be of appropriate type -------------- #
  mutate(
    round = as.integer(round),
    date = as.Date(date),
    driver = paste(first_name, last_name),
    # Suppressing warning NA coercion is desired
    position = suppressWarnings(as.integer(position)),
    points = as.integer(points)
  ) %>% 
  select(race_name, round, date, driver, constructor, position, points)

print(head(f1_tbl, n = 10L))
```

<br/>


### Task 2 - Drivers' Championship

#### Write up

We begin our table creation by first selecting only the relevant columns. We then
proceed to calculate the F1 rankings for the 2019 season before pivoting wider
to make each row represent the positions of a single driver across the season.
Our table columns were renamed, as well as the points tally relocated to the end
of the table, in order improve the overall readability of the presentation.

#### Code

```{r task2}
# Defining new column names for easy reading
new_colnames = c('Driver', 'AUS', 'BHR', 'CHN', 'AZE', 'ESP', 'MON', 'CAN', 'FRA', 
             'AUT', 'GBR', 'GER', 'HUN', 'BEL', 'ITA', 'SIN', 'RUS', 'JPN', 'MEX',
             'USA', 'BRA', 'ABU', 'Points')

rankings_tbl = f1_tbl %>% 
  select(race_name, driver, position, points) %>%
  # Getting ranking for 2019 season for each driver
  group_by(driver) %>%
  mutate(points = sum(points)) %>%
  # 1 row = 1 driver
  pivot_wider(names_from = race_name, values_from = position) %>%
  arrange(desc(points)) %>%
  # Making points the last column
  relocate(points, .after = last_col())
  colnames(rankings_tbl) = new_colnames

knitr::kable(rankings_tbl)
```

<br/>

### Task 3 - Cumulative Constructors

#### Write up

<!-- Include write up here -->

#### Code

```{r task3}

```

<br/>

### Task 4 - Visualization

#### Write up

<!-- Include write up here -->

#### Code

```{r task4}

```

<br/>

